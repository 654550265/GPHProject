/*
* 通用
* @date: 2015-12-21
* @author: SunXiaowen
*/
;(function(win,$,undefined){	
	var pub=(function(){
		return{
			url:function(){
//				var domain = document.domain;
//				if(domain.indexOf("vipmro.net")>0||domain.indexOf("vipmro.cn")>0||domain.indexOf("vipmro.com")>0){
//					return "http://"+domain+"/emro_interface";
//				} else {
//					return "http://"+domain+":8080/emro_interface";
//				}
				//var domain = document.domain;
				//return "http://"+domain+":8080/emro_interface";
				
				//获取当前网址，如： http://localhost:8080/Tmall/index.jsp 
				var curWwwPath=window.document.location.href; 

				//获取主机地址之后的目录如：/Tmall/index.jsp 
				var pathName=window.document.location.pathname; 
				var pos=curWwwPath.indexOf(pathName); 

				//获取主机地址，如： http://localhost:8080 
				var localhostPaht;
				if(pathName != '' && pathName !='/'){
					localhostPaht=curWwwPath.substring(0,pos); 
				}else{
					localhostPaht=window.document.location.protocol+"//"+window.document.location.hostname;
				}
				
				//获取带"/"的项目名，如：/Tmall 
				//var projectName=pathName.substring(0,pathName.substr(1).indexOf('/')+1); 
				return localhostPaht + "/emro_interface";
			},
			
			urls:function(){
				var strFullPath = window.document.location.href,
				    pathname=window.document.location.pathname,
				    hostname=window.document.location.hostname,
				    port=window.document.location.port,
				    protocol=window.document.location.protocol,
				    rootUrl;
				if(strFullPath.indexOf("vipmro.net")>0||strFullPath.indexOf("vipmro.cn")>0||strFullPath.indexOf("vipmro.com")>0){
					rootUrl=protocol+"//"+hostname;
				}else{
					rootUrl=protocol+"//"+hostname+":"+port+pathname.substr(0,pathname.substr(1).indexOf('/')+1);
				}
			    return rootUrl;
			},
			
			load:function(url, data, methods,successfn, errorfn){
				data = (data == null || data == "" || typeof (data) == "undefined") ? {} : data;
				data._cache=Math.random(15);
				methods = (methods == null || methods == "" || typeof (methods) == "undefined") ? "POST" : methods;
				var queryString=$.param(data),
				    dataPw={};
				dataPw.url=url;
				dataPw.queryString=queryString;
				$.ajax({
					type : "POST",
					data : dataPw,
					url : this.urls()+"/sign/",
					dataType : "json"
				}).success(function(p){
					if(p){
						data.sign=p;
						$.ajax({
							type : methods,
							data : data,
							url : url,
							dataType : "json"
						}).success(function(d){
							successfn(d);
						}).error(function(e){
							errorfn(e);
						});	
					}
				}).error(function(q){
					console.log(q);
				});
			},
			
			loadNoSign:function(url, data, methods,successfn, errorfn){
				data = (data == null || data == "" || typeof (data) == "undefined") ? {} : data;
				methods = (methods == null || methods == "" || typeof (methods) == "undefined") ? "POST" : methods;
				$.ajax({
					type : methods,
					data : data,
					url : url,
					dataType : "json"
				}).success(function(p){
					successfn(p);					
				}).error(function(q){
					errorfn(q);
				});
			},
			
			/*图片上传吴*/
			load_file:function(url, data, methods,successfn, errorfn){
				data = (data == null || data == "" || typeof (data) == "undefined") ? {} : data;
				methods = (methods == null || methods == "" || typeof (methods) == "undefined") ? "POST" : methods;
				var sdata=data;
				sdata.append('url',url);
				$.ajax({
					type : "POST",
					data : sdata,
					url : this.urls()+"/sign/",
					dataType : "json"
				}).success(function(p){
					if(p){
						data.append("sign", p);
						$.ajax({
							type : methods,
							data : data,
							url : url,
							dataType : "json",
							 cache: false,
		     		            contentType: false,    //不可缺
		     		            processData: false,  //不可缺
						}).success(function(d){
							successfn(d);
						}).error(function(e){
							errorfn(e);
						});	
					}
				}).error(function(q){
					console.log(q);
				});
			},
			getStr:function(name){
			     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
			     var r = window.location.search.substr(1).match(reg);
			     if(r!=null){
			    	 return  unescape(r[2]);
			     }else{
			    	 return null;
			     }
			},
			
			getDetailAdd:function(poster){
		    	var add="";
		    	$.each(poster.area,function(m,n){
					if(n.id==poster.provinceId){
						add+=n.name+" ";
					}
					if(n.id==poster.cityId){
						add+=n.name+" ";
					}
					if(n.id==poster.areaId){
						add+=n.name+" ";
					}
					if(n.id==poster.townId){
						add+=n.name+" ";
					}
				});
		    	
		    	return add;
		    },
			
			getId:function(){
				var p=window.location.href.split("?")[0],
				      reg=/\/$/gi,
				      p=p.replace(reg,"");
				      b=p.split("/"),
		              l=b.length-1;
				return b[l].replace("#","");
			},
			
			toFixed:function(t){
				return parseFloat(t).toFixed(2);
			},
			
			countDown:function(t,d,h,m,s){/*传过来时间，天，小时，分，秒*1为需要显示*/
				var oneDay=86400,
				    oneHour=3600,
				    oneMinute=60,
				    days,
				    hours,
				    minutes,
				    seconds,
				    goInDate="";
				days=Math.floor(t/oneDay);
				if(d==1){
					goInDate+=days+"天";
				}
				hours=Math.floor((t-oneDay*days)/oneHour);
				if(h==1){
				    goInDate+=hours+"小时";
				}
				minutes=Math.floor((t-days*oneDay-hours*oneHour)/oneMinute);
				if(m==1){
					goInDate+=minutes+"分";	
				}
				seconds=t-days*oneDay-hours*oneHour-minutes*oneMinute;
				if(s==1){
				goInDate+=seconds+"秒";
				}
				return goInDate;
			},
			
			checkEmpty:function(t){
    			if(t==""){
    				return false;
    			}else{
    				return true;
    			}
    		},
			
    		checkTel:function(t){
				var reg=/(^([0\*][0-9\*]{2,3}\s)?([2-9\*][0-9\*]{6,7})+(\-[0-9\*]{1,4})?$)|(^([0\*][0-9\*]{2,3})?([2-9\*][0-9\*]{6,7})+(\-[0-9\*]{1,4})?$)|(^([0\*][0-9\*]{2,3}[\-\*])?([2-9\*][0-9\*]{6,7})+(\-[0-9\*]{1,4})?$)|(^((\(\d{3}\))|(\d{3}\-))?([1\*][3578\*][0-9\*]{9})$)/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},
			
			checkPhone:function(t){
				var reg=/^1[34578][0-9\*]{9}$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},
			
			checkPsw:function(t){
				var reg=/((?=.*\d)(?=.*\D)|(?=.*[a-zA-Z])(?=.*[^a-zA-Z]))^.{8,16}$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},
			
			checkBankName:function(t){
				var reg=/^[\u4E00-\u9FA5]{2,80}$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},
			
			checkBankAccount:function(t){
				var reg=/^(\d{1,25})$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},
			
			checkEmail:function(t){
				var reg=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},						
			
			checkPostcode:function(t){
				var reg=/^[0-9][0-9]{5}$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},
			
			checkName:function(t){
				var reg=/^([\u4e00-\u9fa5\·]{1,20}|[a-zA-Z\·\.\s]{1,20})$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},	
			
			checkAddress:function(t){
				var reg=/^[\u4E00-\u9FA5A-Za-z\d\-\_\#\(\)\（\）\s]{1,60}$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},	
			
			checkTaxpayeRno:function(t){
				var reg=/^([A-Za-z\d]{15}|[A-Za-z\d]{18}|[A-Za-z\d]{20})$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},	
			
			checkBlank:function(t){
				var reg=/^[^\s]*$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},	
			
			checkQq:function(t){
		        var reg=/^\d{4,15}$/;
				if(reg.test(t)){
					return true;
				}else{
					return false;
				}
			},
			
			getCarNum:function(c){
	        	this.load(this.url()+"/cart/cartNum/",null,"GET",function(s){
	        		if(s.code==0){
	        			if(s.data){
	        				if(s.data>=100){
	        					s.data="99+";
	        				}	        				
	        			}else{
	        				s.data='0';
	        			}   
	        			c.html(s.data);
	        		}
	        	},function(e){
	        		console.log(e);
	        	});
			},
			
			addCart:function(l,d,callback){
				var _this_=this;
				this.load(this.url()+"/cart/mallAdd/",d,"POST",function(s){
        			if(s.code==0){
        				_this_.getCarNum(l);
        				if(callback){
        					callback();
        				}        				
        			}else{
        				alert(s.msg);
        			}
        		},function(e){
        			console.log(e);
        		});
			},
			
			getCollect:function(c1,api,c2){
            	var data={};
            	if(c2){
            		data.sellerGoodsId=c2.attr("attr-sellerGoodsId");
            	}
        		this.load(api,data,"GET",function(s){
        			if(s.code==0){
        				if(s.data==1){
        					c1.addClass("on").attr("attr-type","1");
        				}
        			}
        		},function(e){
        			console.log(e);
        		});
        	},
			
			openWindow:function(v,w,h,fuc){/*alert的值，宽度,高度*/
				var windowHtml=
					'<div class="p-open-window J_p_window">'+
					'</div>'+
					'<div class="p-open-window-box J_p_window_box">'+
					'<div class="p-open-window-ls J_p_window_ls">'+
					'<img src="'+this.urls()+'/image/x.png'+'" class="J_p_window_close">'+
					'<div class="clearFix"></div>'+
					'<div class="p-open-window-cont J_p_window_cont">'+v+'</div>'+
					'<span class="J_p_window_close but">确认</span>'+
					'</div>'+
					'</div>';					
				$("body").append(windowHtml);
				if(h>=400){
					$(".J_p_window_box").css({
						"position":"absolute",
						"top":$(document).scrollTop()+"px"
					});
				}
				$(".J_p_window").css({
					   "height":$(document).height()+"px" 
				});
				$(".J_p_window_box").css({
					"width":w+"px",
					"marginLeft":"-"+(w/2)+"px",
					"height":h+"px"
				});
				$(".J_p_window_ls").css({
					"width":(w-16)+"px",
					"marginLeft":"8px",
					"height":(h-16)+"px",
					"marginTop":"8px"
				});
				$(".J_p_window_cont").css({
					"width":(w-16)+"px"
				});
				$(".J_p_window_ls span.but").css({
					"marginLeft":((w-16-50)/2)+"px"
				});
				$(".J_p_window_close").bind("click",function(){
					$(".J_p_window,.J_p_window_box").remove();
					if(fuc){
						fuc();
					}
				});
			},
			
			setUrlCookie:function(dom1,dom2){
				var _this_=this;
        		$(dom1).on("mouseover",dom2,function(){
        			_this_.setCookie("catchUrl",$(this).attr("href"));
        		});
        	},
			
			setCookie:function(key,value){
				window.localStorage.setItem(key,value);
			},
			
			getCookie:function(key){
				return window.localStorage.getItem(key);
			},
			
			cookie:function(poster){
				var defaults={
					  "cookieName":""	,
					  "cookieValue":0,
					  "cookieUrl":"/",
					  "cookieDate":1
				};
				$.extend(defaults,poster||{});
				$.cookie(defaults.cookieName,defaults.cookieValue,{expires:defaults.cookieDate,path:defaults.cookieUrl});
			},
			
			dataFormat:function(ns,y,m,d,h,min,s){/*1为显示 0为隐藏*/
				ns=new Date(ns);
				var year=ns.getFullYear(),
				    month=ns.getMonth()+1,
				    date=ns.getDate(),
				    hour=ns.getHours(),
				    minute=ns.getMinutes(),
				    second=ns.getSeconds(),
				    format1=[],
				    format2=[]; 
				if(y==1){
					format1.push(year);
				}
				if(m==1){
					format1.push(month);
				}
				if(d==1){
					format1.push(date);
				}
				if(h==1){
					if(hour<10){
						hour="0"+hour;
					}
					format2.push(hour);
				}
				if(min==1){
					if(minute<10){
						minute="0"+minute;
					}
					format2.push(minute);
				}
				if(s==1){
					if(second<10){
						second="0"+second;
					}
					format2.push(second);
				}
	            return format1.join("-")+"   "+format2.join(":"); 
			},
			operaWu_Time:function(nData){
				//格式化时间
				if(nData!=null && nData!="null" && nData!=""){
					var data=new Date(parseInt(nData));
					var nowYear=data.getFullYear();
					var nowMonth=data.getMonth()+1;  
					var nowDay=data.getDate();  
					var nowHours=data.getHours();  
					var nowMine=data.getMinutes();  
					var nowSeconds=data.getSeconds();
					if(nowHours<10){
						nowHours="0"+nowHours;
					}
					if(nowMine<10){
						nowMine="0"+nowMine;
					}
					if(nowSeconds<10){
						nowSeconds="0"+nowSeconds;
					}
					var nowData=nowYear+"年"+nowMonth+"月"+nowDay+"日 "+nowHours+":"+nowMine+":"+nowSeconds;
				}else{
					var nowData="";
				}
				
				return nowData;

			},
			
			operaOrderStatus:function(inv_status){
				//订单状态
				var inv_statust;
				if(inv_status=="1"){
					inv_statust="待付款";
        		}else if(inv_status=="2"){
        			inv_statust="待发货";
        		}else if(inv_status=="3"){
        			inv_statust="已发货（待收货）";
        		}else if(inv_status=="4"){
        			inv_statust="已收货（待结算）";
        		}else if(inv_status=="5"){
        			inv_statust="对账中（已结算）";
        		}else if(inv_status=="6"){
        			inv_statust="已完成";
        		}else if(inv_status=="7"){
        			inv_statust="退货中";
        		}else if(inv_status=="8"){
        			inv_statust="已取消";
        		}else if(inv_status=="9"){
        			inv_statust="待确认付款";
        		}
				return inv_statust;
			},
			
			checkPayLineType:function(v){
				if(!v){
					v="";
				}
				if(v==1){
					v="银联支付";
				}
				if(v==2){
					v="线下支付";
				}
				if(v==3){
					v="支付宝支付";
				}
				if(v==4){
					v="余额支付";
				}
				return v;
			}
			
		};
	})();
	
	win.pubFuc=pub;
})(this,jQuery,{});

